{"version":3,"file":"smart-table-keyboard.js","sources":["../lib/keymap.js","../index.js"],"sourcesContent":["const findContainer = (element, selector) => element.matches(selector) === true ? element : findContainer(element.parentElement, selector);\n\nexport function keyGrid (grid, {cellSelector, rowSelector}) {\n\n  const doesSkipKeyboard = el => el.getAttribute('data-keyboard-skip') === 'true';\n\n  const createGrid = (grid) => {\n    const instance = {};\n    Object.defineProperty(instance, 'rows', {\n      get(){\n        return grid.rows !== void 0 ? grid.rows : [...grid.querySelectorAll(rowSelector)]\n      }\n    });\n\n    Object.defineProperty(instance, 'element', {value: grid});\n    return instance;\n  };\n\n  const gridWrapped = createGrid(grid);\n\n  const rowProto = {\n    moveUp(){\n      const rowIndex = this.rowIndex;\n      const newRowIndex = Math.max(rowIndex - 1, 0);\n      const newRow = gridWrapped.rows[newRowIndex];\n      if (doesSkipKeyboard(newRow) === false) {\n        return newRow;\n      } else if (newRowIndex === 0) {\n        return this.element;\n      } else {\n        return createRow(newRow).moveUp();\n      }\n    },\n    moveDown(){\n      const rowIndex = this.rowIndex;\n      const newRowIndex = Math.min(rowIndex + 1, gridWrapped.rows.length - 1);\n      const newRow = gridWrapped.rows[newRowIndex];\n      if (doesSkipKeyboard(newRow) === false) {\n        return newRow;\n      } else if (newRowIndex === gridWrapped.rows.length - 1) {\n        return this.element;\n      } else {\n        return createRow(newRow).moveDown();\n      }\n    }\n  };\n\n  function createRow (rowElement) {\n    return Object.create(rowProto, {\n      cells: {\n        get(){\n          return rowElement.cells !== void 0 ? [...rowElement.cells] : [...rowElement.querySelectorAll(cellSelector)];\n        }\n      },\n      rowIndex: {\n        get(){\n          return rowElement.rowIndex !== void 0 ? rowElement.rowIndex : [...grid.querySelectorAll(rowSelector)].indexOf(rowElement);\n        }\n      },\n      element: {value: rowElement}\n    });\n  }\n\n  const cellProto = {\n    moveRight(){\n      const row = createRow(findContainer(this.element, rowSelector));\n      const rowCells = row.cells;\n      const cellIndex = this.cellIndex;\n      const newIndex = Math.min(rowCells.length - 1, cellIndex + 1);\n      const newCell = rowCells[newIndex];\n      if (doesSkipKeyboard(newCell) === false) {\n        return newCell;\n      } else if (newIndex === rowCells.length - 1) {\n        return this.element;\n      } else {\n        return createCell(newCell).moveRight();\n      }\n    },\n    moveLeft(){\n      const row = createRow(findContainer(this.element, rowSelector));\n      const rowCells = row.cells;\n      const cellIndex = this.cellIndex;\n      const newIndex = Math.max(0, cellIndex - 1);\n      const newCell = rowCells[newIndex];\n      if (doesSkipKeyboard(newCell) === false) {\n        return newCell;\n      } else if (newIndex === 0) {\n        return this.element;\n      } else {\n        return createCell(newCell).moveLeft();\n      }\n    }\n  };\n\n  const virtualCellProto = {\n    moveRight(){\n      if (this.currentIndex === this.virtualCells.length - 1) {\n        const newCell = createCell(this.cellElement).moveRight();\n        return newCell === this.cellElement ? this.element : newCell;\n      } else {\n        return this.virtualCells[this.currentIndex + 1];\n      }\n    },\n    moveLeft(){\n      if (this.currentIndex === 0) {\n        const newCell = createCell(this.cellElement).moveLeft();\n        return newCell === this.cellElement ? this.element : newCell;\n      } else {\n        return this.virtualCells[this.currentIndex - 1];\n      }\n    }\n  };\n\n  function createCell (cellElement) {\n    const row = findContainer(cellElement, rowSelector);\n    return Object.create(cellProto, {\n      cellIndex: {\n        get(){\n          return cellElement.cellIndex !== void 0 ? cellElement.cellIndex : [...row.querySelectorAll(cellSelector)].indexOf(cellElement);\n        }\n      },\n      element: {value: cellElement}\n    });\n  }\n\n  function createCompositeCell (cellElement, element) {\n    const selector = cellElement.getAttribute('data-keyboard-selector');\n    const virtualCells = [...cellElement.querySelectorAll(selector)];\n    const currentIndex = virtualCells.indexOf(element);\n    return Object.create(virtualCellProto, {\n      virtualCells: {value: virtualCells},\n      currentIndex: {value: currentIndex},\n      cellElement: {value: cellElement},\n      element: {value: element}\n    });\n  }\n\n  const moveRight = (target) => {\n    const cellElement = findContainer(target, cellSelector);\n    const cell = cellElement === target ? createCell(cellElement) : createCompositeCell(cellElement, target);\n    return cell.moveRight();\n  };\n\n  const moveLeft = target => {\n    const cellElement = findContainer(target, cellSelector);\n    const cell = cellElement === target ? createCell(cellElement) : createCompositeCell(cellElement, target);\n    return cell.moveLeft();\n  };\n\n  const moveUp = target => {\n    const cell = createCell(findContainer(target, cellSelector));\n    const row = createRow(findContainer(cell.element, rowSelector));\n    const cellIndex = cell.cellIndex;\n    const newRow = createRow(row.moveUp());\n    const newCell = newRow.cells[Math.min(newRow.cells.length - 1, cellIndex)];\n    return newCell.hasAttribute('data-keyboard-skip') === false ? newCell : createCell(newCell).moveLeft();\n  };\n\n  const moveDown = target => {\n    const cell = createCell(findContainer(target, cellSelector));\n    const row = createRow(findContainer(cell.element, rowSelector));\n    const cellIndex = cell.cellIndex;\n    const newRow = createRow(row.moveDown());\n    const newCell = newRow.cells[Math.min(newRow.cells.length - 1, cellIndex)];\n    return newCell.hasAttribute('data-keyboard-skip') === false ? newCell : createCell(newCell).moveLeft();\n  };\n\n  return {\n    moveDown,\n    moveLeft,\n    moveUp,\n    moveRight\n  };\n}","import {keyGrid} from './lib/keymap';\n\nexport default function gridKeyMap (grid, {cellSelector = 'td,th', rowSelector = 'tr'} ={}) {\n\n  let lastFocused = null;\n\n  const kg = keyGrid(grid, {cellSelector, rowSelector});\n\n  grid.addEventListener('keydown', (ev) => {\n    const {target, keyCode} =ev;\n    let newFocused = null;\n    if (keyCode === 37) {//left\n      newFocused = kg.moveLeft(target);\n    } else if (keyCode === 38) {//up\n      newFocused = kg.moveUp(target);\n    } else if (keyCode === 39) {//right\n      newFocused = kg.moveRight(target);\n    } else if (keyCode === 40) {//down\n      newFocused = kg.moveDown(target);\n    }\n    if (newFocused !== null) {\n      if (lastFocused !== null) {\n        lastFocused.setAttribute('tabindex', '-1');\n      }\n      newFocused.focus();\n      newFocused.setAttribute('tabindex', '0');\n      lastFocused = newFocused;\n    }\n  });\n\n  let hasNotSkipAttribute = el => el.hasAttribute('data-keyboard-skip') === false;\n  const rows = Array.from(grid.querySelectorAll(rowSelector)).filter(hasNotSkipAttribute);\n  for (let r of rows) {\n    const cells = [...r.querySelectorAll(cellSelector)].filter(hasNotSkipAttribute);\n    for (let c of cells) {\n      if (lastFocused === null) {\n        lastFocused = c;\n      }\n      c.setAttribute('tabindex', '-1');\n    }\n  }\n\n  const cells = [...grid.querySelectorAll(cellSelector)];\n  const composites = cells.filter(c => c.hasAttribute('data-keyboard-selector') === true);\n  for (let c of composites) {\n    c.addEventListener('focus', ev => {\n      const selector = c.getAttribute('data-keyboard-selector');\n      const item = c.querySelector(selector);\n      item.focus();\n    });\n  }\n\n  lastFocused.setAttribute('tabindex', '0');\n}"],"names":[],"mappings":"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"}