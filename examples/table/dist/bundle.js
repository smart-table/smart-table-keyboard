(function () {
'use strict';

const findContainer = (element, selector) => element.matches(selector) === true ? element : findContainer(element.parentElement, selector);

function keyGrid (grid, {cellSelector, rowSelector}) {

  const doesSkipKeyboard = el => el.getAttribute('data-keyboard-skip') === 'true';

  const createGrid = (grid) => {
    const instance = {};
    Object.defineProperty(instance, 'rows', {
      get(){
        return grid.rows !== void 0 ? grid.rows : [...grid.querySelectorAll(rowSelector)]
      }
    });

    Object.defineProperty(instance, 'element', {value: grid});
    return instance;
  };

  const gridWrapped = createGrid(grid);

  const rowProto = {
    moveUp(){
      const rowIndex = this.rowIndex;
      const newRowIndex = Math.max(rowIndex - 1, 0);
      const newRow = gridWrapped.rows[newRowIndex];
      if (doesSkipKeyboard(newRow) === false) {
        return newRow;
      } else if (newRowIndex === 0) {
        return this.element;
      } else {
        return createRow(newRow).moveUp();
      }
    },
    moveDown(){
      const rowIndex = this.rowIndex;
      const newRowIndex = Math.min(rowIndex + 1, gridWrapped.rows.length - 1);
      const newRow = gridWrapped.rows[newRowIndex];
      if (doesSkipKeyboard(newRow) === false) {
        return newRow;
      } else if (newRowIndex === gridWrapped.rows.length) {
        return this.element;
      } else {
        return createRow(newRow).moveDown();
      }
    }
  };

  function createRow (rowElement) {
    return Object.create(rowProto, {
      cells: {
        get(){
          return rowElement.cells !== void 0 ? [...rowElement.cells] : [...rowElement.querySelectorAll(cellSelector)];
        }
      },
      rowIndex: {
        get(){
          return rowElement.rowIndex !== void 0 ? rowElement.rowIndex : [...grid.querySelectorAll(rowSelector)].indexOf(rowElement);
        }
      },
      element: {value: rowElement}
    });
  }

  const cellProto = {
    moveRight(){
      const row = createRow(findContainer(this.element, rowSelector));
      const rowCells = row.cells;
      const cellIndex = this.cellIndex;
      const newIndex = Math.min(rowCells.length - 1, cellIndex + 1);
      const newCell = rowCells[newIndex];
      if (doesSkipKeyboard(newCell) === false) {
        return newCell;
      } else if (newIndex === rowCells.length - 1) {
        return this.element;
      } else {
        return createCell(newCell).moveRight();
      }
    },
    moveLeft(){
      const row = createRow(findContainer(this.element, rowSelector));
      const rowCells = row.cells;
      const cellIndex = this.cellIndex;
      const newIndex = Math.max(0, cellIndex - 1);
      const newCell = rowCells[newIndex];
      if (doesSkipKeyboard(newCell) === false) {
        return newCell;
      } else if (newIndex === 0) {
        return this.element;
      } else {
        return createCell(newCell).moveLeft();
      }
    }
  };

  const virtualCellProto = {
    moveRight(){
      if (this.currentIndex === this.virtualCells.length - 1) {
        const newCell = createCell(this.cellElement).moveRight();
        return newCell === this.cellElement ? this.element : newCell;
      } else {
        return this.virtualCells[this.currentIndex + 1];
      }
    },
    moveLeft(){
      if (this.currentIndex === 0) {
        const newCell = createCell(this.cellElement).moveLeft();
        return newCell === this.cellElement ? this.element : newCell;
      } else {
        return this.virtualCells[this.currentIndex - 1];
      }
    }
  };

  function createCell (cellElement) {
    const row = findContainer(cellElement, rowSelector);
    return Object.create(cellProto, {
      cellIndex: {
        get(){
          return cellElement.cellIndex !== void 0 ? cellElement.cellIndex : [...row.querySelectorAll(cellSelector)].indexOf(cellElement);
        }
      },
      element: {value: cellElement}
    });
  }

  function createCompositeCell (cellElement, element) {
    const selector = cellElement.getAttribute('data-keyboard-selector');
    const virtualCells = [...cellElement.querySelectorAll(selector)];
    const currentIndex = virtualCells.indexOf(element);
    return Object.create(virtualCellProto, {
      virtualCells: {value: virtualCells},
      currentIndex: {value: currentIndex},
      cellElement: {value: cellElement},
      element: {value: element}
    });
  }

  const moveRight = (target) => {
    const cellElement = findContainer(target, cellSelector);
    const cell = cellElement === target ? createCell(cellElement) : createCompositeCell(cellElement, target);
    return cell.moveRight();
  };

  const moveLeft = target => {
    const cellElement = findContainer(target, cellSelector);
    const cell = cellElement === target ? createCell(cellElement) : createCompositeCell(cellElement, target);
    return cell.moveLeft();
  };

  const moveUp = target => {
    const cell = createCell(findContainer(target, cellSelector));
    const row = createRow(findContainer(cell.element, rowSelector));
    const cellIndex = cell.cellIndex;
    const newRow = createRow(row.moveUp());
    const newCell = newRow.cells[Math.min(newRow.cells.length - 1, cellIndex)];
    return newCell.hasAttribute('data-keyboard-skip') === false ? newCell : createCell(newCell).moveLeft(); //todo get "virtual" index taking into account colspan
  };

  const moveDown = target => {
    const cell = createCell(findContainer(target, cellSelector));
    const row = createRow(findContainer(cell.element, rowSelector));
    const cellIndex = cell.cellIndex;
    const newRow = createRow(row.moveDown());
    const newCell = newRow.cells[Math.min(newRow.cells.length - 1, cellIndex)];
    return newCell.hasAttribute('data-keyboard-skip') === false ? newCell : createCell(newCell).moveLeft();
  };

  return {
    moveDown,
    moveLeft,
    moveUp,
    moveRight
  };
}

function gridKeyMap (grid, {cellSelector = 'td,th', rowSelector = 'tr'} ={}) {

  let lastFocused = null;

  const kg = keyGrid(grid, {cellSelector, rowSelector});

  grid.addEventListener('keydown', (ev) => {
    const {target, keyCode} =ev;
    let newFocused = null;
    if (keyCode === 37) {//left
      newFocused = kg.moveLeft(target);
    } else if (keyCode === 38) {//up
      newFocused = kg.moveUp(target);
    } else if (keyCode === 39) {//right
      newFocused = kg.moveRight(target);
    } else if (keyCode === 40) {//down
      newFocused = kg.moveDown(target);
    }
    if (newFocused !== null) {
      if (lastFocused !== null) {
        lastFocused.setAttribute('tabindex', '-1');
      }
      newFocused.focus();
      newFocused.setAttribute('tabindex', '0');
      lastFocused = newFocused;
    }
  });

  let hasNotSkipAttribute = el => el.hasAttribute('data-keyboard-skip') === false;
  const rows = [...grid.querySelectorAll(rowSelector)].filter(hasNotSkipAttribute);
  for (let r of rows) {
    const cells = [...r.querySelectorAll(cellSelector)].filter(hasNotSkipAttribute);
    for (let c of cells) {
      if (lastFocused === null) {
        lastFocused = c;
      }
      c.setAttribute('tabindex', '-1');
    }
  }

  const cells = [...grid.querySelectorAll(cellSelector)];
  const composites = cells.filter(c => c.hasAttribute('data-keyboard-selector') === true);
  for (let c of composites) {
    c.addEventListener('focus', ev => {
      const selector = c.getAttribute('data-keyboard-selector');
      const item = c.querySelector(selector);
      item.focus();
    });
  }

  lastFocused.setAttribute('tabindex','0');
}

gridKeyMap(document.querySelector('[role=grid]'));

}());
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9saWIva2V5bWFwLmpzIiwiLi4vLi4vLi4vaW5kZXguanMiLCIuLi9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBmaW5kQ29udGFpbmVyID0gKGVsZW1lbnQsIHNlbGVjdG9yKSA9PiBlbGVtZW50Lm1hdGNoZXMoc2VsZWN0b3IpID09PSB0cnVlID8gZWxlbWVudCA6IGZpbmRDb250YWluZXIoZWxlbWVudC5wYXJlbnRFbGVtZW50LCBzZWxlY3Rvcik7XG5cbmV4cG9ydCBmdW5jdGlvbiBrZXlHcmlkIChncmlkLCB7Y2VsbFNlbGVjdG9yLCByb3dTZWxlY3Rvcn0pIHtcblxuICBjb25zdCBkb2VzU2tpcEtleWJvYXJkID0gZWwgPT4gZWwuZ2V0QXR0cmlidXRlKCdkYXRhLWtleWJvYXJkLXNraXAnKSA9PT0gJ3RydWUnO1xuXG4gIGNvbnN0IGNyZWF0ZUdyaWQgPSAoZ3JpZCkgPT4ge1xuICAgIGNvbnN0IGluc3RhbmNlID0ge307XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGluc3RhbmNlLCAncm93cycsIHtcbiAgICAgIGdldCgpe1xuICAgICAgICByZXR1cm4gZ3JpZC5yb3dzICE9PSB2b2lkIDAgPyBncmlkLnJvd3MgOiBbLi4uZ3JpZC5xdWVyeVNlbGVjdG9yQWxsKHJvd1NlbGVjdG9yKV1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpbnN0YW5jZSwgJ2VsZW1lbnQnLCB7dmFsdWU6IGdyaWR9KTtcbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH07XG5cbiAgY29uc3QgZ3JpZFdyYXBwZWQgPSBjcmVhdGVHcmlkKGdyaWQpO1xuXG4gIGNvbnN0IHJvd1Byb3RvID0ge1xuICAgIG1vdmVVcCgpe1xuICAgICAgY29uc3Qgcm93SW5kZXggPSB0aGlzLnJvd0luZGV4O1xuICAgICAgY29uc3QgbmV3Um93SW5kZXggPSBNYXRoLm1heChyb3dJbmRleCAtIDEsIDApO1xuICAgICAgY29uc3QgbmV3Um93ID0gZ3JpZFdyYXBwZWQucm93c1tuZXdSb3dJbmRleF07XG4gICAgICBpZiAoZG9lc1NraXBLZXlib2FyZChuZXdSb3cpID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gbmV3Um93O1xuICAgICAgfSBlbHNlIGlmIChuZXdSb3dJbmRleCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZVJvdyhuZXdSb3cpLm1vdmVVcCgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgbW92ZURvd24oKXtcbiAgICAgIGNvbnN0IHJvd0luZGV4ID0gdGhpcy5yb3dJbmRleDtcbiAgICAgIGNvbnN0IG5ld1Jvd0luZGV4ID0gTWF0aC5taW4ocm93SW5kZXggKyAxLCBncmlkV3JhcHBlZC5yb3dzLmxlbmd0aCAtIDEpO1xuICAgICAgY29uc3QgbmV3Um93ID0gZ3JpZFdyYXBwZWQucm93c1tuZXdSb3dJbmRleF07XG4gICAgICBpZiAoZG9lc1NraXBLZXlib2FyZChuZXdSb3cpID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gbmV3Um93O1xuICAgICAgfSBlbHNlIGlmIChuZXdSb3dJbmRleCA9PT0gZ3JpZFdyYXBwZWQucm93cy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBjcmVhdGVSb3cobmV3Um93KS5tb3ZlRG93bigpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBmdW5jdGlvbiBjcmVhdGVSb3cgKHJvd0VsZW1lbnQpIHtcbiAgICByZXR1cm4gT2JqZWN0LmNyZWF0ZShyb3dQcm90bywge1xuICAgICAgY2VsbHM6IHtcbiAgICAgICAgZ2V0KCl7XG4gICAgICAgICAgcmV0dXJuIHJvd0VsZW1lbnQuY2VsbHMgIT09IHZvaWQgMCA/IFsuLi5yb3dFbGVtZW50LmNlbGxzXSA6IFsuLi5yb3dFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY2VsbFNlbGVjdG9yKV07XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByb3dJbmRleDoge1xuICAgICAgICBnZXQoKXtcbiAgICAgICAgICByZXR1cm4gcm93RWxlbWVudC5yb3dJbmRleCAhPT0gdm9pZCAwID8gcm93RWxlbWVudC5yb3dJbmRleCA6IFsuLi5ncmlkLnF1ZXJ5U2VsZWN0b3JBbGwocm93U2VsZWN0b3IpXS5pbmRleE9mKHJvd0VsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZWxlbWVudDoge3ZhbHVlOiByb3dFbGVtZW50fVxuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgY2VsbFByb3RvID0ge1xuICAgIG1vdmVSaWdodCgpe1xuICAgICAgY29uc3Qgcm93ID0gY3JlYXRlUm93KGZpbmRDb250YWluZXIodGhpcy5lbGVtZW50LCByb3dTZWxlY3RvcikpO1xuICAgICAgY29uc3Qgcm93Q2VsbHMgPSByb3cuY2VsbHM7XG4gICAgICBjb25zdCBjZWxsSW5kZXggPSB0aGlzLmNlbGxJbmRleDtcbiAgICAgIGNvbnN0IG5ld0luZGV4ID0gTWF0aC5taW4ocm93Q2VsbHMubGVuZ3RoIC0gMSwgY2VsbEluZGV4ICsgMSk7XG4gICAgICBjb25zdCBuZXdDZWxsID0gcm93Q2VsbHNbbmV3SW5kZXhdO1xuICAgICAgaWYgKGRvZXNTa2lwS2V5Ym9hcmQobmV3Q2VsbCkgPT09IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiBuZXdDZWxsO1xuICAgICAgfSBlbHNlIGlmIChuZXdJbmRleCA9PT0gcm93Q2VsbHMubGVuZ3RoIC0gMSkge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZUNlbGwobmV3Q2VsbCkubW92ZVJpZ2h0KCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBtb3ZlTGVmdCgpe1xuICAgICAgY29uc3Qgcm93ID0gY3JlYXRlUm93KGZpbmRDb250YWluZXIodGhpcy5lbGVtZW50LCByb3dTZWxlY3RvcikpO1xuICAgICAgY29uc3Qgcm93Q2VsbHMgPSByb3cuY2VsbHM7XG4gICAgICBjb25zdCBjZWxsSW5kZXggPSB0aGlzLmNlbGxJbmRleDtcbiAgICAgIGNvbnN0IG5ld0luZGV4ID0gTWF0aC5tYXgoMCwgY2VsbEluZGV4IC0gMSk7XG4gICAgICBjb25zdCBuZXdDZWxsID0gcm93Q2VsbHNbbmV3SW5kZXhdO1xuICAgICAgaWYgKGRvZXNTa2lwS2V5Ym9hcmQobmV3Q2VsbCkgPT09IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiBuZXdDZWxsO1xuICAgICAgfSBlbHNlIGlmIChuZXdJbmRleCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZUNlbGwobmV3Q2VsbCkubW92ZUxlZnQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3QgdmlydHVhbENlbGxQcm90byA9IHtcbiAgICBtb3ZlUmlnaHQoKXtcbiAgICAgIGlmICh0aGlzLmN1cnJlbnRJbmRleCA9PT0gdGhpcy52aXJ0dWFsQ2VsbHMubGVuZ3RoIC0gMSkge1xuICAgICAgICBjb25zdCBuZXdDZWxsID0gY3JlYXRlQ2VsbCh0aGlzLmNlbGxFbGVtZW50KS5tb3ZlUmlnaHQoKTtcbiAgICAgICAgcmV0dXJuIG5ld0NlbGwgPT09IHRoaXMuY2VsbEVsZW1lbnQgPyB0aGlzLmVsZW1lbnQgOiBuZXdDZWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlydHVhbENlbGxzW3RoaXMuY3VycmVudEluZGV4ICsgMV07XG4gICAgICB9XG4gICAgfSxcbiAgICBtb3ZlTGVmdCgpe1xuICAgICAgaWYgKHRoaXMuY3VycmVudEluZGV4ID09PSAwKSB7XG4gICAgICAgIGNvbnN0IG5ld0NlbGwgPSBjcmVhdGVDZWxsKHRoaXMuY2VsbEVsZW1lbnQpLm1vdmVMZWZ0KCk7XG4gICAgICAgIHJldHVybiBuZXdDZWxsID09PSB0aGlzLmNlbGxFbGVtZW50ID8gdGhpcy5lbGVtZW50IDogbmV3Q2VsbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZpcnR1YWxDZWxsc1t0aGlzLmN1cnJlbnRJbmRleCAtIDFdO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBmdW5jdGlvbiBjcmVhdGVDZWxsIChjZWxsRWxlbWVudCkge1xuICAgIGNvbnN0IHJvdyA9IGZpbmRDb250YWluZXIoY2VsbEVsZW1lbnQsIHJvd1NlbGVjdG9yKTtcbiAgICByZXR1cm4gT2JqZWN0LmNyZWF0ZShjZWxsUHJvdG8sIHtcbiAgICAgIGNlbGxJbmRleDoge1xuICAgICAgICBnZXQoKXtcbiAgICAgICAgICByZXR1cm4gY2VsbEVsZW1lbnQuY2VsbEluZGV4ICE9PSB2b2lkIDAgPyBjZWxsRWxlbWVudC5jZWxsSW5kZXggOiBbLi4ucm93LnF1ZXJ5U2VsZWN0b3JBbGwoY2VsbFNlbGVjdG9yKV0uaW5kZXhPZihjZWxsRWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBlbGVtZW50OiB7dmFsdWU6IGNlbGxFbGVtZW50fVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gY3JlYXRlQ29tcG9zaXRlQ2VsbCAoY2VsbEVsZW1lbnQsIGVsZW1lbnQpIHtcbiAgICBjb25zdCBzZWxlY3RvciA9IGNlbGxFbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1rZXlib2FyZC1zZWxlY3RvcicpO1xuICAgIGNvbnN0IHZpcnR1YWxDZWxscyA9IFsuLi5jZWxsRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKV07XG4gICAgY29uc3QgY3VycmVudEluZGV4ID0gdmlydHVhbENlbGxzLmluZGV4T2YoZWxlbWVudCk7XG4gICAgcmV0dXJuIE9iamVjdC5jcmVhdGUodmlydHVhbENlbGxQcm90bywge1xuICAgICAgdmlydHVhbENlbGxzOiB7dmFsdWU6IHZpcnR1YWxDZWxsc30sXG4gICAgICBjdXJyZW50SW5kZXg6IHt2YWx1ZTogY3VycmVudEluZGV4fSxcbiAgICAgIGNlbGxFbGVtZW50OiB7dmFsdWU6IGNlbGxFbGVtZW50fSxcbiAgICAgIGVsZW1lbnQ6IHt2YWx1ZTogZWxlbWVudH1cbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IG1vdmVSaWdodCA9ICh0YXJnZXQpID0+IHtcbiAgICBjb25zdCBjZWxsRWxlbWVudCA9IGZpbmRDb250YWluZXIodGFyZ2V0LCBjZWxsU2VsZWN0b3IpO1xuICAgIGNvbnN0IGNlbGwgPSBjZWxsRWxlbWVudCA9PT0gdGFyZ2V0ID8gY3JlYXRlQ2VsbChjZWxsRWxlbWVudCkgOiBjcmVhdGVDb21wb3NpdGVDZWxsKGNlbGxFbGVtZW50LCB0YXJnZXQpO1xuICAgIHJldHVybiBjZWxsLm1vdmVSaWdodCgpO1xuICB9O1xuXG4gIGNvbnN0IG1vdmVMZWZ0ID0gdGFyZ2V0ID0+IHtcbiAgICBjb25zdCBjZWxsRWxlbWVudCA9IGZpbmRDb250YWluZXIodGFyZ2V0LCBjZWxsU2VsZWN0b3IpO1xuICAgIGNvbnN0IGNlbGwgPSBjZWxsRWxlbWVudCA9PT0gdGFyZ2V0ID8gY3JlYXRlQ2VsbChjZWxsRWxlbWVudCkgOiBjcmVhdGVDb21wb3NpdGVDZWxsKGNlbGxFbGVtZW50LCB0YXJnZXQpO1xuICAgIHJldHVybiBjZWxsLm1vdmVMZWZ0KCk7XG4gIH07XG5cbiAgY29uc3QgbW92ZVVwID0gdGFyZ2V0ID0+IHtcbiAgICBjb25zdCBjZWxsID0gY3JlYXRlQ2VsbChmaW5kQ29udGFpbmVyKHRhcmdldCwgY2VsbFNlbGVjdG9yKSk7XG4gICAgY29uc3Qgcm93ID0gY3JlYXRlUm93KGZpbmRDb250YWluZXIoY2VsbC5lbGVtZW50LCByb3dTZWxlY3RvcikpO1xuICAgIGNvbnN0IGNlbGxJbmRleCA9IGNlbGwuY2VsbEluZGV4O1xuICAgIGNvbnN0IG5ld1JvdyA9IGNyZWF0ZVJvdyhyb3cubW92ZVVwKCkpO1xuICAgIGNvbnN0IG5ld0NlbGwgPSBuZXdSb3cuY2VsbHNbTWF0aC5taW4obmV3Um93LmNlbGxzLmxlbmd0aCAtIDEsIGNlbGxJbmRleCldO1xuICAgIHJldHVybiBuZXdDZWxsLmhhc0F0dHJpYnV0ZSgnZGF0YS1rZXlib2FyZC1za2lwJykgPT09IGZhbHNlID8gbmV3Q2VsbCA6IGNyZWF0ZUNlbGwobmV3Q2VsbCkubW92ZUxlZnQoKTsgLy90b2RvIGdldCBcInZpcnR1YWxcIiBpbmRleCB0YWtpbmcgaW50byBhY2NvdW50IGNvbHNwYW5cbiAgfTtcblxuICBjb25zdCBtb3ZlRG93biA9IHRhcmdldCA9PiB7XG4gICAgY29uc3QgY2VsbCA9IGNyZWF0ZUNlbGwoZmluZENvbnRhaW5lcih0YXJnZXQsIGNlbGxTZWxlY3RvcikpO1xuICAgIGNvbnN0IHJvdyA9IGNyZWF0ZVJvdyhmaW5kQ29udGFpbmVyKGNlbGwuZWxlbWVudCwgcm93U2VsZWN0b3IpKTtcbiAgICBjb25zdCBjZWxsSW5kZXggPSBjZWxsLmNlbGxJbmRleDtcbiAgICBjb25zdCBuZXdSb3cgPSBjcmVhdGVSb3cocm93Lm1vdmVEb3duKCkpO1xuICAgIGNvbnN0IG5ld0NlbGwgPSBuZXdSb3cuY2VsbHNbTWF0aC5taW4obmV3Um93LmNlbGxzLmxlbmd0aCAtIDEsIGNlbGxJbmRleCldO1xuICAgIHJldHVybiBuZXdDZWxsLmhhc0F0dHJpYnV0ZSgnZGF0YS1rZXlib2FyZC1za2lwJykgPT09IGZhbHNlID8gbmV3Q2VsbCA6IGNyZWF0ZUNlbGwobmV3Q2VsbCkubW92ZUxlZnQoKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIG1vdmVEb3duLFxuICAgIG1vdmVMZWZ0LFxuICAgIG1vdmVVcCxcbiAgICBtb3ZlUmlnaHRcbiAgfTtcbn0iLCJpbXBvcnQge2tleUdyaWR9IGZyb20gJy4vbGliL2tleW1hcCc7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGdyaWRLZXlNYXAgKGdyaWQsIHtjZWxsU2VsZWN0b3IgPSAndGQsdGgnLCByb3dTZWxlY3RvciA9ICd0cid9ID17fSkge1xuXG4gIGxldCBsYXN0Rm9jdXNlZCA9IG51bGw7XG5cbiAgY29uc3Qga2cgPSBrZXlHcmlkKGdyaWQsIHtjZWxsU2VsZWN0b3IsIHJvd1NlbGVjdG9yfSk7XG5cbiAgZ3JpZC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGV2KSA9PiB7XG4gICAgY29uc3Qge3RhcmdldCwga2V5Q29kZX0gPWV2O1xuICAgIGxldCBuZXdGb2N1c2VkID0gbnVsbDtcbiAgICBpZiAoa2V5Q29kZSA9PT0gMzcpIHsvL2xlZnRcbiAgICAgIG5ld0ZvY3VzZWQgPSBrZy5tb3ZlTGVmdCh0YXJnZXQpO1xuICAgIH0gZWxzZSBpZiAoa2V5Q29kZSA9PT0gMzgpIHsvL3VwXG4gICAgICBuZXdGb2N1c2VkID0ga2cubW92ZVVwKHRhcmdldCk7XG4gICAgfSBlbHNlIGlmIChrZXlDb2RlID09PSAzOSkgey8vcmlnaHRcbiAgICAgIG5ld0ZvY3VzZWQgPSBrZy5tb3ZlUmlnaHQodGFyZ2V0KTtcbiAgICB9IGVsc2UgaWYgKGtleUNvZGUgPT09IDQwKSB7Ly9kb3duXG4gICAgICBuZXdGb2N1c2VkID0ga2cubW92ZURvd24odGFyZ2V0KTtcbiAgICB9XG4gICAgaWYgKG5ld0ZvY3VzZWQgIT09IG51bGwpIHtcbiAgICAgIGlmIChsYXN0Rm9jdXNlZCAhPT0gbnVsbCkge1xuICAgICAgICBsYXN0Rm9jdXNlZC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJy0xJyk7XG4gICAgICB9XG4gICAgICBuZXdGb2N1c2VkLmZvY3VzKCk7XG4gICAgICBuZXdGb2N1c2VkLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xuICAgICAgbGFzdEZvY3VzZWQgPSBuZXdGb2N1c2VkO1xuICAgIH1cbiAgfSk7XG5cbiAgbGV0IGhhc05vdFNraXBBdHRyaWJ1dGUgPSBlbCA9PiBlbC5oYXNBdHRyaWJ1dGUoJ2RhdGEta2V5Ym9hcmQtc2tpcCcpID09PSBmYWxzZTtcbiAgY29uc3Qgcm93cyA9IFsuLi5ncmlkLnF1ZXJ5U2VsZWN0b3JBbGwocm93U2VsZWN0b3IpXS5maWx0ZXIoaGFzTm90U2tpcEF0dHJpYnV0ZSk7XG4gIGZvciAobGV0IHIgb2Ygcm93cykge1xuICAgIGNvbnN0IGNlbGxzID0gWy4uLnIucXVlcnlTZWxlY3RvckFsbChjZWxsU2VsZWN0b3IpXS5maWx0ZXIoaGFzTm90U2tpcEF0dHJpYnV0ZSk7XG4gICAgZm9yIChsZXQgYyBvZiBjZWxscykge1xuICAgICAgaWYgKGxhc3RGb2N1c2VkID09PSBudWxsKSB7XG4gICAgICAgIGxhc3RGb2N1c2VkID0gYztcbiAgICAgIH1cbiAgICAgIGMuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICctMScpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGNlbGxzID0gWy4uLmdyaWQucXVlcnlTZWxlY3RvckFsbChjZWxsU2VsZWN0b3IpXTtcbiAgY29uc3QgY29tcG9zaXRlcyA9IGNlbGxzLmZpbHRlcihjID0+IGMuaGFzQXR0cmlidXRlKCdkYXRhLWtleWJvYXJkLXNlbGVjdG9yJykgPT09IHRydWUpO1xuICBmb3IgKGxldCBjIG9mIGNvbXBvc2l0ZXMpIHtcbiAgICBjLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgZXYgPT4ge1xuICAgICAgY29uc3Qgc2VsZWN0b3IgPSBjLmdldEF0dHJpYnV0ZSgnZGF0YS1rZXlib2FyZC1zZWxlY3RvcicpO1xuICAgICAgY29uc3QgaXRlbSA9IGMucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gICAgICBpdGVtLmZvY3VzKCk7XG4gICAgfSk7XG4gIH1cblxuICBsYXN0Rm9jdXNlZC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywnMCcpO1xufSIsImltcG9ydCBrZXltYXAgZnJvbSAnLi4vLi4vaW5kZXgnO1xuXG5rZXltYXAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW3JvbGU9Z3JpZF0nKSk7Il0sIm5hbWVzIjpbImtleW1hcCJdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsTUFBTSxhQUFhLEdBQUcsQ0FBQyxPQUFPLEVBQUUsUUFB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
